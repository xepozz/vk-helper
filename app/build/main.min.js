!function(i){function e(e){for(var t,n,o=e[0],r=e[1],l=e[2],a=0,u=[];a<o.length;a++)n=o[a],c[n]&&u.push(c[n][0]),c[n]=0;for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(i[t]=r[t]);for(p&&p(e);u.length;)u.shift()();return f.push.apply(f,l||[]),s()}function s(){for(var e,t=0;t<f.length;t++){for(var n=f[t],o=!0,r=1;r<n.length;r++){var l=n[r];0!==c[l]&&(o=!1)}o&&(f.splice(t--,1),e=a(a.s=n[0]))}return e}var n={},c={1:0},f=[];function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=i,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var r=0;r<t.length;r++)e(t[r]);var p=o;f.push([106,2,0]),s()}({106:function(e,t,n){"use strict";n(107),n(132);var o=u(n(0)),r=u(n(24)),l=u(n(25)),a=u(n(138));function u(e){return e&&e.__esModule?e:{default:e}}l.default.send("VKWebAppInit",{}),r.default.render(o.default.createElement(a.default,null),document.getElementById("root"))},138:function(e,d,b){"use strict";(function(e){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var n=t(b(0)),o=t(b(25));b(26);b(143);t(b(146));var r=t(b(147)),l=t(b(92)),a=t(b(257));function t(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=s(this,c(t).call(this,e))).go=function(e){var t=e.currentTarget.dataset,n=t.toPanel?{activePanel:t.toPanel}:t.toView?{activeView:t.toView}:null;console.log("go ",n),null!==n&&o.setState(n)},console.log("App"),o.state={activeView:"home-view",activePanel:"home-index-panel",user:null,accessToken:null},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.default.Component),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"componentDidMount",value:function(){var t=this;o.default.subscribe(function(e){switch(e.detail.type){case"VKWebAppGetUserInfoResult":t.setState({user:e.detail.data});break;case"VKWebAppAccessTokenReceived":console.log("VKWebAppAccessTokenReceived"),console.log(e.detail.data),t.setState({accessToken:e.detail.data.access_token});break;case"VKWebAppAccessTokenFailed":console.log("VKWebAppAccessTokenFailed"),console.log(e.detail.data);break;default:console.log(e.detail.type)}}),console.log(e.env,"friends,groups,status"),o.default.send("VKWebAppGetAuthToken",{app_id:parseInt("7026981"),scope:"friends,groups,status"}),o.default.send("VKWebAppGetUserInfo",{})}},{key:"render",value:function(){return n.default.createElement(l.default,{activeView:this.state.activeView},n.default.createElement(a.default,{id:"home-view",activePanel:this.state.activePanel,go:this.go}),n.default.createElement(r.default,{id:"groups-list-view",go:this.go,accessToken:this.state.accessToken,user:this.state.user}))}}]),t}();d.default=p}).call(this,b(83))},146:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=l(n(0)),r=(l(n(1)),n(26));function l(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,s(e).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(e,o.default.Component),function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(e,[{key:"render",value:function(){return o.default.createElement(r.Panel,{id:this.props.id},o.default.createElement(r.PanelHeader,null,"VK Helper"),this.props.fetchedUser&&o.default.createElement(r.Group,{title:"Информация о текущем пользователе"},o.default.createElement(r.ListItem,{before:this.props.fetchedUser.photo_200?o.default.createElement(r.Avatar,{src:this.props.fetchedUser.photo_200}):null,description:this.props.fetchedUser.city&&this.props.fetchedUser.city.title?this.props.fetchedUser.city.title:""},"".concat(this.props.fetchedUser.first_name," ").concat(this.props.fetchedUser.last_name))),o.default.createElement(r.Group,{title:"Действия"},o.default.createElement(r.Div,null,o.default.createElement(r.Button,{size:"xl",level:"2",onClick:this.props.go,"data-to":"groups-list-view"},"Группы, от которых можно отписаться"))))}}]),e}();t.default=f},147:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=a(n(0)),i=(a(n(1)),n(26)),o=a(n(148)),r=a(n(34)),s=a(n(149)),c=a(n(150)),l=a(n(85)),f=a(n(87)),p=a(n(88)),d=a(n(90)),b=a(n(25)),h=a(n(57)),y=a(n(58)),v=(n(152),a(n(99))),m=a(n(60)),g=a(n(59));function a(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=(0,i.platform)(),k=function(){function a(e){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(l=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?P(e):t}(this,O(a).call(this,e))).unsubscribe=function(){var t=l.getSelectedGroups(),n=Object.keys(t).filter(function(e){return!!t[e]}),e=l.state.groupsList.filter(function(e,t){return console.log(t.id,n),n.includes(t.id)});l.setState({popout:u.default.createElement(m.default,{actionsLayout:"vertical",actions:[{title:"Отписаться",autoclose:!0,style:"destructive"},{title:"Отмена",autoclose:!0,style:"cancel"}],onClose:l.closePopout},u.default.createElement("h2",null,"Подтвердите действие"),u.default.createElement("p",null,"Вы действительно хотите отписаться от следующих сообществ/событий:",e.join(", ")," ",n.join(", "),"?"))}),console.log(n)},l.createTable=function(){var e=[],t=l.state.invalidGroups,n=t.length;if(0<n){for(var o=0;o<n;++o){var r=t[o];e.push(u.default.createElement(p.default,{key:o,selectable:!0,"data-group-id":r.id,onChange:l.onChange,before:r.photo_200?u.default.createElement(i.Avatar,{src:r.photo_200}):u.default.createElement(s.default,null)},u.default.createElement(d.default,{href:"https://vk.com/group"+r.id,target:"_blank"},r.name)))}e.push(u.default.createElement(h.default,null,u.default.createElement(y.default,{size:"xl",level:"primary",onClick:l.unsubscribe,before:u.default.createElement(c.default,null)},"Отписаться")))}else e.push(u.default.createElement(p.default,{key:"none"},"Групп не обнаружено"));return e},console.log("GroupsListView"),l.state={activePanel:"groups-list-panel",popout:null,groupsList:[],invalidGroups:[],selectedGroups:{}},l.onChange=l.onChange.bind(P(l)),l.setSpinner=l.setSpinner.bind(P(l)),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(a,u.default.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(a,[{key:"componentDidMount",value:function(){var r=this;b.default.subscribe(function(e){switch(e.detail.type){case"VKWebAppCallAPIMethodResult":console.log("VKWebAppCallAPIMethodResult");var t=e.detail.data.response,n=t.items;console.log(t,n),r.setState({groupsList:n});var o=a.filterInvalidGroups(n);console.log(o),r.setState({invalidGroups:o}),r.setSpinner(!1);break;case"VKWebAppCallAPIMethodFailed":r.setSpinner(!1);break;default:console.log(e.detail.type,e.detail)}}),this.setSpinner(!0),b.default.send("VKWebAppCallAPIMethod",{method:"groups.get",request_id:Math.random(),params:{fields:"activity,is_hidden_from_feed,is_messages_blocked,member_status,verified,deactivated,ban_info,has_photo",user_ids:this.props.user?this.props.user:"1",extended:!0,v:"5.95",access_token:this.props.accessToken}})}},{key:"setSpinner",value:function(e){var t=e?u.default.createElement(v.default,null):null;this.setState({popout:t})}},{key:"onChange",value:function(e){var t=e.currentTarget,n=t.dataset,o=this.getSelectedGroups();o[n.groupId]=t.checked,this.setState({items:o})}},{key:"getSelectedGroups",value:function(){return this.state.selectedGroups}},{key:"render",value:function(){return u.default.createElement(g.default,{id:this.props.id,popout:this.state.popout,activePanel:this.state.activePanel},u.default.createElement(i.Panel,{id:"groups-list-panel"},u.default.createElement(i.PanelHeader,{left:u.default.createElement(i.HeaderButton,{onClick:this.props.go,"data-to":"home"},S===i.IOS?u.default.createElement(o.default,null):u.default.createElement(r.default,null))},"Сообщества, от которых можно отписаться"),u.default.createElement(l.default,null,u.default.createElement(f.default,null,this.createTable()))))}}],[{key:"filterInvalidGroups",value:function(e){return e.filter(function(e,t){console.log(e.name);var n="deactivated"in e;n&&console.log("isDeactivated");var o="ban_info"in e;o&&console.log("isUserBanned");var r="has_photo"in e&&0===parseInt(e.has_photo);r&&console.log("hasNoPhoto");var l="is_hidden_from_feed"in e&&1===parseInt(e.is_hidden_from_feed);l&&console.log("isHiddenFromFeed");var a="member_status"in e&&[0,2,3,4].includes(e.member_status);a&&console.log("invalidMemberStatus");var u="members_count"in e&&e.members_count<5;u&&console.log("smallMembersCount");var i="finish_date"in e&&e.finish_date<(new Date).getTime();return i&&console.log("isEventPassed"),n||o||r||l||i||a||u})}}]),a}();t.default=k}});