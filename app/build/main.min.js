!function(l){function e(e){for(var t,n,o=e[0],r=e[1],u=e[2],a=0,i=[];a<o.length;a++)n=o[a],c[n]&&i.push(c[n][0]),c[n]=0;for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(l[t]=r[t]);for(p&&p(e);i.length;)i.shift()();return f.push.apply(f,u||[]),s()}function s(){for(var e,t=0;t<f.length;t++){for(var n=f[t],o=!0,r=1;r<n.length;r++){var u=n[r];0!==c[u]&&(o=!1)}o&&(f.splice(t--,1),e=a(a.s=n[0]))}return e}var n={},c={1:0},f=[];function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=l,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var r=0;r<t.length;r++)e(t[r]);var p=o;f.push([158,2,0]),s()}({158:function(e,t,n){"use strict";n(159),n(161);var o=i(n(1)),r=i(n(63)),u=i(n(126)),a=i(n(166));function i(e){return e&&e.__esModule?e:{default:e}}u.default.send("VKWebAppInit",{}),r.default.render(o.default.createElement(a.default,null),document.getElementById("root"))},166:function(e,d,h){"use strict";(function(e){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var n=t(h(1)),o=t(h(126));h(56);h(172);t(h(177));var r=t(h(178)),u=t(h(379)),a=t(h(380));function t(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=s(this,c(t).call(this,e))).go=function(e){var t=e.currentTarget.dataset,n=t.toPanel?{activePanel:t.toPanel}:t.toView?{activeView:t.toView}:null;console.log("go ",n),null!==n&&o.setState(n)},o.state={activeView:"home-view",activePanel:"home-index-panel",user:null,accessToken:null},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.default.Component),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"componentDidMount",value:function(){var t=this;o.default.subscribe(function(e){switch(e.detail.type){case"VKWebAppGetUserInfoResult":t.setState({user:e.detail.data});break;case"VKWebAppAccessTokenReceived":console.log("VKWebAppAccessTokenReceived"),console.log(e.detail.data),t.setState({accessToken:e.detail.data.access_token});break;case"VKWebAppAccessTokenFailed":console.log("VKWebAppAccessTokenFailed"),console.log(e.detail.data);break;default:console.log(e.detail.type)}}),console.log(e.env,"friends,groups,status"),o.default.send("VKWebAppGetAuthToken",{app_id:parseInt("7026981"),scope:"friends,groups,status"}),o.default.send("VKWebAppGetUserInfo",{})}},{key:"render",value:function(){return n.default.createElement(u.default,{activeView:this.state.activeView},n.default.createElement(a.default,{id:"home-view",activePanel:this.state.activePanel,go:this.go}),n.default.createElement(r.default,{id:"groups-list-view",go:this.go,accessToken:this.state.accessToken,user:this.state.user}))}}]),t}();d.default=p}).call(this,h(167))},177:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=u(n(1)),r=(u(n(7)),n(56));function u(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,s(e).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(e,o.default.Component),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"render",value:function(){return o.default.createElement(r.Panel,{id:this.props.id},o.default.createElement(r.PanelHeader,null,"VK Helper"),this.props.fetchedUser&&o.default.createElement(r.Group,{title:"Информация о текущем пользователе"},o.default.createElement(r.ListItem,{before:this.props.fetchedUser.photo_200?o.default.createElement(r.Avatar,{src:this.props.fetchedUser.photo_200}):null,description:this.props.fetchedUser.city&&this.props.fetchedUser.city.title?this.props.fetchedUser.city.title:""},"".concat(this.props.fetchedUser.first_name," ").concat(this.props.fetchedUser.last_name))),o.default.createElement(r.Group,{title:"Действия"},o.default.createElement(r.Div,null,o.default.createElement(r.Button,{size:"xl",level:"2",onClick:this.props.go,"data-to":"groups-list-view"},"Группы, от которых можно отписаться"))))}}]),e}();t.default=f},178:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),i=(r(n(7)),n(56)),o=r(n(179)),u=r(n(90)),l=r(n(180)),s=r(n(181)),c=r(n(182)),f=r(n(184)),p=r(n(185)),d=r(n(187)),h=r(n(188)),b=r(n(369)),y=r(n(370)),v=r(n(372)),m=r(n(374)),g=r(n(375));function r(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=(0,i.platform)(),P=function(){function r(e){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(u=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?S(e):t}(this,O(r).call(this,e))).unsubscribe=function(){var e=u.getGroupsToLeave().map(function(e){return e.name}).join(", ");u.showAlert(e)},u.createTable=function(){var e=[],t=u.state.invalidGroups,n=t.length;if(0<n){for(var o=0;o<n;++o){var r=t[o];e.push(a.default.createElement(p.default,{key:o,selectable:!0,"data-group-id":r.id,onChange:u.onChange,before:r.photo_200?a.default.createElement(i.Avatar,{src:r.photo_200}):a.default.createElement(l.default,null)},a.default.createElement(d.default,{href:"https://vk.com/group"+r.id,target:"_blank"},r.name)))}e.push(a.default.createElement(b.default,null,a.default.createElement(y.default,{size:"xl",level:"primary",onClick:u.unsubscribe,before:a.default.createElement(s.default,null)},"Отписаться")))}else e.push(a.default.createElement(p.default,{key:"none"},"Групп не обнаружено"));return e},console.log("GroupsListView"),u.state={activePanel:"groups-list-panel",popout:null,groupsList:[],invalidGroups:[],selectedGroups:{}},u.onChange=u.onChange.bind(S(u)),u.setSpinner=u.setSpinner.bind(S(u)),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(r,a.default.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(r,[{key:"componentDidMount",value:function(){var o=this;this.setSpinner(!0),h.default.send("VKWebAppCallAPIMethod",{method:"groups.get",request_id:Math.random(),params:{fields:"activity,is_hidden_from_feed,is_messages_blocked,member_status,verified,deactivated,ban_info,has_photo",user_ids:this.props.user?this.props.user:"1",extended:!0,v:"5.95",access_token:this.props.accessToken}}).then(function(e){console.log(e);var t=e.response.items;o.setState({groupsList:t});var n=r.filterInvalidGroups(t);o.setState({invalidGroups:n})}).catch(function(e){return console.error(e)}).finally(function(){return o.setSpinner(!1)})}},{key:"setSpinner",value:function(e){var t=e?a.default.createElement(v.default,null):null;this.setState({popout:t})}},{key:"getGroupsToLeave",value:function(){var t=this.getSelectedGroups(),n=Object.keys(t).filter(function(e){return!!t[e]});return this.state.groupsList.filter(function(e){return n.includes(String(e.id))})}},{key:"leaveFromGroups",value:function(){var e=this;this.setSpinner(!0);var t=this.getGroupsToLeave().reduce(function(e,t){return e+'API.groups.leave({"group_id": '+t.id+")"})+";";console.log(t),h.default.send("VKWebAppCallAPIMethod",{method:"groups.leave",request_id:Math.random(),params:{code:JSON.stringify(t),v:"5.95",access_token:this.props.accessToken}}).then(function(e){console.log(e)}).catch(function(e){return console.error(e)}).finally(function(){return e.setSpinner(!1)})}},{key:"showAlert",value:function(e){var t=this;this.setState({popout:a.default.createElement(m.default,{actionsLayout:"vertical",actions:[{title:"Отписаться",autoclose:!0,action:this.leaveFromGroups,style:"destructive"},{title:"Отмена",autoclose:!0,style:"cancel"}],onClose:function(){return t.setSpinner(!1)}},a.default.createElement("h2",null,"Подтвердите действие"),a.default.createElement("p",null,"Вы действительно хотите отписаться от следующих сообществ/событий: ",e,"?"))})}},{key:"onChange",value:function(e){var t=e.currentTarget,n=t.dataset,o=this.getSelectedGroups();o[n.groupId]=t.checked,this.setState({items:o})}},{key:"getSelectedGroups",value:function(){return this.state.selectedGroups}},{key:"render",value:function(){return a.default.createElement(g.default,{id:this.props.id,popout:this.state.popout,activePanel:this.state.activePanel},a.default.createElement(i.Panel,{id:"groups-list-panel"},a.default.createElement(i.PanelHeader,{left:a.default.createElement(i.HeaderButton,{onClick:this.props.go,"data-to":"home"},E===i.IOS?a.default.createElement(o.default,null):a.default.createElement(u.default,null))},"Сообщества, от которых можно отписаться"),a.default.createElement(c.default,null,a.default.createElement(f.default,null,this.createTable()))))}}],[{key:"filterInvalidGroups",value:function(e){return e.filter(function(e,t){var n="deactivated"in e,o="ban_info"in e,r="has_photo"in e&&0===parseInt(e.has_photo),u="is_hidden_from_feed"in e&&1===parseInt(e.is_hidden_from_feed),a="member_status"in e&&[0,2,3,4].includes(e.member_status),i="members_count"in e&&e.members_count<5,l="finish_date"in e&&e.finish_date<(new Date).getTime();return n||o||r||u||l||a||i})}}]),r}();t.default=P}});